{"version":3,"file":"main.js","mappings":"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","sources":["webpack://CHARNAME's Bag of Macros/webpack/bootstrap","webpack://CHARNAME's Bag of Macros/webpack/runtime/define property getters","webpack://CHARNAME's Bag of Macros/webpack/runtime/hasOwnProperty shorthand","webpack://CHARNAME's Bag of Macros/./src/scripts/constants.js","webpack://CHARNAME's Bag of Macros/./src/scripts/helper-functions.js","webpack://CHARNAME's Bag of Macros/./src/scripts/macros/spells/aura-of-purity.js","webpack://CHARNAME's Bag of Macros/./src/scripts/macros/spells/clairvoyance.js","webpack://CHARNAME's Bag of Macros/./src/scripts/macros/spells/daylight.js","webpack://CHARNAME's Bag of Macros/./src/scripts/hooks.js","webpack://CHARNAME's Bag of Macros/./src/scripts/macros/features/horde-passive.js","webpack://CHARNAME's Bag of Macros/./src/scripts/macros/items/wand-of-fear.js","webpack://CHARNAME's Bag of Macros/./src/scripts/macros.js","webpack://CHARNAME's Bag of Macros/./src/scripts/macros/spells/blight.js","webpack://CHARNAME's Bag of Macros/./src/scripts/macros/features/fey-ancestry.js","webpack://CHARNAME's Bag of Macros/./src/scripts/macros/features/class/bard/song-of-rest.js","webpack://CHARNAME's Bag of Macros/./src/scripts/socket-functions.js","webpack://CHARNAME's Bag of Macros/./src/scripts/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","export const conditionLabels = {\r\n\tblinded: [\"blinded\", \"convenient effect: blinded\"],\r\n\tcharmed: [\"charmed\", \"convenient effect: charmed\"],\r\n\tconcentrating: [\"concentrating\", \"convenient effect: concentrating\"],\r\n\tdead: [\"dead\", \"convenient effect: dead\"],\r\n\tdeafened: [\"deafened\", \"convenient effect: deafened\"],\r\n\texhaustion1: [\"exhaustion 1\", \"convenient effect: exhaustion 1\"],\r\n\texhaustion2: [\"exhaustion 2\", \"convenient effect: exhaustion 2\"],\r\n\texhaustion3: [\"exhaustion 3\", \"convenient effect: exhaustion 3\"],\r\n\texhaustion4: [\"exhaustion 4\", \"convenient effect: exhaustion 4\"],\r\n\texhaustion5: [\"exhaustion 5\", \"convenient effect: exhaustion 5\"],\r\n\tfrightened: [\"frightened\", \"convenient effect: frightened\"],\r\n\tgrappled: [\"grappled\", \"convenient effect: grappled\"],\r\n\tincapacitated: [\"incapacitated\", \"convenient effect: incapacitated\"],\r\n\tinvisible: [\"invisible\", \"convenient effect: invisible\"],\r\n\tparalyzed: [\"paralyzed\", \"convenient effect: paralyzed\"],\r\n\tpetrified: [\"petrified\", \"convenient effect: petrified\"],\r\n\tpoisoned: [\"poisoned\", \"convenient effect: poisoned\"],\r\n\tprone: [\"prone\", \"convenient effect: prone\"],\r\n\trestrained: [\"restrained\", \"convenient effect: restrained\"],\r\n\tstunned: [\"stunned\", \"convenient effect: stunned\"],\r\n\tunconscious: [\"unconscious\", \"convenient effect: unconscious\"],\r\n\twounded: [\"wounded\", \"convenient effect: wounded\"]\r\n}\r\n\r\nexport const cloudSpellNames = [\r\n\t\"Cloudkill\",\r\n\t\"Incendiary Cloud\",\r\n\t\"Insect Plague\",\r\n\t\"Moonbeam\",\r\n\t\"Spirit Guardians\"\r\n]","import {settings} from \"./settings.js\"\r\nimport {socket} from \"./index.js\"\r\n\r\nexport const getDialogueButtons = (resolve, choices, getIconPaths, width, height) => {\r\n\treturn choices.reduce((buttons, choice, i) => {\r\n\t\tconst icon = getIconPaths(choice)\r\n\t\tconst newButton = {[choice]: {\r\n\t\t\tlabel: `<img src=${icon} width=${width} height=${height} style=\"border:0px\"><br>${choice}`,\r\n\t\t\tcallback: () => {\r\n\t\t\t\tresolve({value: `${choice}`})\r\n\t\t\t}\r\n\t\t}}\r\n\t\treturn {...buttons, ...newButton}\r\n\t}, {})\r\n}\r\nexport const getDialogueButtonType = async (choices, dialogueOptions, title, getIconPathsFunc, buttonWidth, buttonHeight) => { \r\n\treturn await (new Promise( (resolve) => {\r\n\t\tconst buttons = getDialogueButtons(resolve, choices, getIconPathsFunc, buttonWidth, buttonHeight)\r\n\t\tnew Dialog({\r\n\t\t\ttitle: title,\r\n\t\t\tbuttons: buttons\r\n\t\t}, dialogueOptions).render(true)\r\n}))}\r\nexport const getSpawnLocation = async (spawnIconPath, size, interval, tokenUuid, itemRange, originToken) => {\r\n\tawait setCrosshairConfigs(tokenUuid, itemRange)\r\n\tconst distanceAvailable = itemRange\r\n\tlet crosshairsDistance = 0\r\n\tconst checkDistance = async (crosshairs) => {\r\n\t\twhile (crosshairs.inFlight) {\r\n\t\t\tawait warpgate.wait(100)\r\n\t\t\tconst ray = new Ray(originToken.center, crosshairs)\r\n\t\t\tconst distance = canvas.grid.measureDistances([{ ray }], { gridSpaces: true })[0]\r\n\t\t\tif (crosshairsDistance !== distance) {\r\n\t\t\t\tcrosshairsDistance = distance;\r\n\t\t\t\tif (distance > distanceAvailable) {\r\n\t\t\t\t\tcrosshairs.icon = 'icons/svg/hazard.svg';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcrosshairs.icon = spawnIconPath\r\n\t\t\t\t}\r\n\t\t\t\tcrosshairs.draw();\r\n\t\t\t\tcrosshairs.label = `${distance} ft`;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tconst location = await warpgate.crosshairs.show(\r\n\t\t{\r\n\t\t\tsize: size,\r\n\t\t\tinterval: interval,\r\n\t\t\ticon: spawnIconPath,\r\n\t\t\tlabel: '0 ft.',\r\n\t\t},\r\n\t\t{\r\n\t\t\tshow: checkDistance\r\n\t\t},\r\n\t)\r\n\tif (location.cancelled || crosshairsDistance > distanceAvailable) {\r\n\t\treturn\r\n\t} else {\r\n\t\treturn location\r\n\t}\r\n}\r\nexport const getTemplatesInRange = (templates, gridSize, gridScale, range, x1, y1) => {\r\n\t//gets templates where center of template within range of a cast template\r\n\treturn templates.filter(template => {\r\n\t\tconst [a, b] = [x1 - template.x, y1 - template.y]\r\n\t\tconst c  = Math.sqrt(Math.pow(a,2) + Math.pow(b,2)) \r\n\t\tconst templateCentersDistance = c / gridSize\t\r\n\t\tconst templateRangeModified = template.distance / gridScale\t\r\n\t\tconst itemRangeModified = range / gridScale\t\t\r\n\t\treturn templateCentersDistance < templateRangeModified + itemRangeModified\r\n\t})\r\n}\r\nexport const getTemplatesWithOverlap = (eligibleTemplates, itemTemplatePositions) => {\r\n\treturn eligibleTemplates.filter(template => {\r\n\t\tconst gridTemplateId = \"MeasuredTemplate.\" + template.id\r\n\t\tconst templatePositions = canvas.grid.highlightLayers[gridTemplateId]?.positions ?? new Set(\"-1\")\r\n\t\treturn itemTemplatePositions.intersection(templatePositions).size > 0\r\n\t})\r\n}\r\nexport const getTokensInRange = async (tokens, gridSize, gridScale, itemRange, x1, y1) => {\r\n\treturn tokens.filter(token => {\r\n\t\tconst tokenTopLeftCenterX = token.x + gridSize / 2\r\n\t\tconst tokenTopLeftCenterY = token.y + gridSize / 2\r\n\t\tlet tokenGridBorderCoords = []\r\n\t\t\r\n\t\tfor (let i = 0; i <= token.width * 2 - 1; i++) {\r\n\t\t\tfor (let j = 0; j <= token.width * 2  - 1; j++) {\r\n\t\t\t\ttokenGridBorderCoords.push({x: tokenTopLeftCenterX + gridSize / 2 * i, y: tokenTopLeftCenterY + gridSize / 2 * j})\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tconst xArr = tokenGridBorderCoords.map(coord => coord.x)\r\n\t\tconst yArr = tokenGridBorderCoords.map(coord => coord.y)\r\n\t\tconst maxX = Math.max(...xArr)\r\n\t\tconst maxY = Math.max(...yArr)\r\n\t\tconst tokenGridCoords = tokenGridBorderCoords.filter(coords => coords.x != maxX && coords.y != maxY)\r\n\t\t\r\n\t\tconst tokenGridCoordsInRange = tokenGridCoords.filter(coord => {\r\n\t\t\tconst [x2, y2] = [coord.x, coord.y]\r\n\t\t\tconst a = x1 - x2\r\n\t\t\tconst b = y1 - y2\r\n\t\t\tconst c = Math.sqrt(Math.pow(a,2) + Math.pow(b,2)) \r\n\t\t\treturn c / gridSize <= itemRange / gridScale\r\n\t\t})\r\n\t\t\r\n\t\treturn tokenGridCoordsInRange.length > 0\r\n\t})\r\n}\r\nexport const setActiveEffects = async (tokenActorUuids, effectData) => {\r\n\tconst createEffect = async (tokenActorUuid, effectData) => {return await MidiQOL.socket().executeAsGM(\"createEffects\", {actorUuid: tokenActorUuid, effects: [effectData]})}\r\n\tconst [effects] = await Promise.all(tokenActorUuids.map(tokenActorUuid => createEffect(tokenActorUuid, effectData)))\r\n\treturn effects\r\n}\r\nexport const setActorConcDeletion = async (actor) => {\r\n\tif (actor.effects.find(effect => effect.name == \"Concentrating\")) actor.effects.find(effect => effect.name == \"Concentrating\").delete()\r\n} \r\nexport const setActorConcRemoveUuids = async (originActor, uuid) => {\r\n\tlet originActorConcentrationRemoveUuids = originActor.flags[\"midi-qol\"][\"concentration-data\"]?.removeUuids || []\r\n\toriginActorConcentrationRemoveUuids.push(uuid)\t\r\n\tawait originActor.update({\"flags.midi-qol\": {\"concentration-data\": {removeUuids: originActorConcentrationRemoveUuids}}})\r\n\tconst concEffect = originActor.effects.find(effect => effect.name == \"Concentrating\")\r\n\tawait concEffect.update({\r\n\t\t\"flags.dae\": {\"specialDuration\": [\"shortRest\", \"longRest\"]}\r\n\t})\r\n}\r\nexport const setActorReagentCost = async (actorUuid, itemUuid) => {\r\n\tconst actor = await fromUuid(actorUuid)\r\n\tconst item = await fromUuid(itemUuid)\t\r\n\tif (settings.reagentsConsume = \"money\")  {\r\n\t\t//set this to pull from the lower denominations first\r\n\t\tconst newMoney = actor.system.currency.gp - item.system.materials.cost\r\n\t\tif (newMoney < 0) return false\r\n\t\tactor.update({\"system.currency.gp\": newMoney})\r\n\t} else if (settings.reagentsConsume = \"supply\") {\r\n\t\tconst newSupply = item.system.materials.supply - 1\r\n\t\tif (newSupply < 0) return false\r\n\t\titem.update({\"system.materials.supply\": newSupply})\r\n\t} else {\r\n\t\treturn false\r\n\t}\r\n\treturn true\r\n}\r\nexport const setCrosshairConfigs = async (tokenUuid, itemRange) => {\r\n\tconst target = await fromUuid(tokenUuid)\r\n\tconst {distance} = canvas.scene.grid\r\n\twarpgate.crosshairs.show({\r\n\t\tlockSize:true,\r\n\t\tlockPosition: true,\r\n\t\tsize: target.width + (2*itemRange/distance),\r\n\t\ttag: 'range',\r\n\t\tdrawIcon:false,\r\n\t\tlabel: 'Valid Area',\r\n\t\tx: target.x,\r\n\t\ty: target.y,\r\n\t\trememberControlled: true\r\n\t})\t\r\n\tcanvas.tokens.activate()\r\n}\r\nexport const setTemplateDispels = async (x, y, name, itemTemplatePositions) => {\r\n\tconst dnd5eFlaggedTemplates = canvas.scene.templates.filter(template => template.flags.dnd5e)\r\n\tconst potentialTemplates = dnd5eFlaggedTemplates.filter(template => {\r\n\t\tconst originName = fromUuidSync(template.flags.dnd5e.origin).name\r\n\t\tif (!name) {\r\n\t\t\treturn template.flags.dnd5e.spellLevel\r\n\t\t} else {\r\n\t\t\treturn template.flags.dnd5e.spellLevel && originName == name\t\r\n\t\t}\r\n\t})\r\n\tconst templatesInRange = getTemplatesInRange(potentialTemplates, canvas.scene.grid.size, canvas.scene.grid.distance, 60, x, y)\r\n\tconst templatesWithOverlap = getTemplatesWithOverlap(templatesInRange, itemTemplatePositions)\r\n\ttemplatesWithOverlap.map(template => {socket.executeAsGM(\"setMeasuredTemplateDelete\", template.uuid)})\r\n}","import {conditionLabels} from \"../../constants.js\"\r\nimport {getTokensInRange} from \"../../helper-functions.js\"\r\n\r\nasync function getEligibleTokenDocuments(tokenDocuments, scene, itemRange, originX, originY) {\r\n\tconst tokenDocsInRange = await getTokensInRange(tokenDocuments, scene.grid.size, scene.grid.distance, itemRange, originX, originY)\r\n\tif (!tokenDocsInRange) return false\r\n\tconst templateNonEffectedTokens = await getNonTemplateEffectedTokenDocs(tokenDocsInRange)\r\n\tif (!templateNonEffectedTokens) return false\r\n\treturn templateNonEffectedTokens\r\n}\r\nasync function getNonTemplateEffectedTokenDocs(tokenDocuments, itemEffectName) {\r\n\treturn tokenDocuments.filter(token => {\r\n\t\tconst effects = token.actor.statuses\r\n\t\treturn effects.has(itemEffectName) == false\r\n\t})\r\n}\r\nconst onUse = async ({args, workflow, item, actor, token}) => {\r\n\tconst itemEffectName = \"Convenient Effect: Aura of Purity\"\r\n\tconst template = await fromUuid(args[0].templateUuid)\r\n\tawait tokenAttacher.attachElementToToken(template, token, true)\r\n\tconst scene = await fromUuid(template.parent.uuid)\r\n\tconst itemRange = args[0].item.system.target.value\r\n\tconst tokenDocs = Array.from(scene.collections.tokens.values())\r\n\t\r\n\tconst eligibleTokenDocs = await getEligibleTokenDocuments(tokenDocs, scene, itemRange, template.x, template.y)\r\n\tif (!eligibleTokenDocs) return false\r\n\r\n\tconst tokenEffectUuids = await setTokenEffects(eligibleTokenDocs, token.document.disposition)\r\n\tawait template.update({\r\n\t\t\"flags.castData.auraOfPurity.tokensEffected\": tokenEffectUuids\r\n\t})\r\n}\r\nconst preTargetSave = async ({args, workflow, item, actor}) => {\r\n\tconst itemHasEffect = item.effects.some(effect => effect.changes.some(change => {\r\n\t\treturn conditionLabels[\"blinded\"].includes(change.value.toLowerCase())\r\n\t\t\t|| conditionLabels[\"charmed\"].includes(change.value.toLowerCase())\r\n\t\t\t|| conditionLabels[\"deafened\"].includes(change.value.toLowerCase())\r\n\t\t\t|| conditionLabels[\"frightened\"].includes(change.value.toLowerCase())\r\n\t\t\t|| conditionLabels[\"paralyzed\"].includes(change.value.toLowerCase())\r\n\t\t\t|| conditionLabels[\"poisoned\"].includes(change.value.toLowerCase())\r\n\t\t\t|| conditionLabels[\"stunned\"].includes(change.value.toLowerCase())\r\n\t}))\r\n\tif (itemHasEffect) workflow.saveDetails.advantage = true\r\n}\r\nasync function setTokenEffects(tokenDocs, casterDisposition) {\r\n\tlet effected = []\r\n\tlet uuid = \"\"\r\n\tfor (let i=0; i < tokenDocs.length; i++) {\r\n\t\tconsole.log(\"tokenDocs[i]\")\r\n\t\tconsole.log(tokenDocs[i])\r\n\t\tuuid = tokenDocs[i].actor.uuid\r\n\t\tif ((casterDisposition == 1 && tokenDocs[i].disposition != -1)\r\n\t\t\t|| (casterDisposition == -1  && tokenDocs[i].disposition != 1)) {\r\n\t\t\tgame.dfreds.effectInterface.addEffect( {effectName: 'Aura of Purity', uuid} )\r\n\t\t\teffected.push(uuid)\r\n\t\t}\r\n\t}\r\n\treturn effected\r\n}\r\n\r\nexport const auraOfPurity = {\r\n\tpreTargetSave,\r\n\tonUse\r\n}","import {getSpawnLocation, setActorConcDeletion, setActorConcRemoveUuids} from \"../../helper-functions.js\"\r\nimport {socket} from \"../../index.js\"\r\n\r\nconst getSpawnUpdates = async (originActorSenses, originTokenSight) => {\r\n\treturn {\r\n\t\ttoken: {\r\n\t\t\t\"displayName\": CONST.TOKEN_DISPLAY_MODES.HOVER,\r\n\t\t\t\"alpha\": 0,\r\n\t\t\t\"sight\": originTokenSight\r\n\t\t},\r\n\t\tactor: {\r\n\t\t\t\"system.attributes.senses\": originActorSenses\r\n\t\t}\r\n\t}\r\n}\r\nconst getTokenSpawnIds = async (tokenUuid, itemRange, actor, originToken) => {\r\n\tconst spawnedTokenId = await setSpawnedTokenId(tokenUuid, itemRange, actor, originToken)\r\n\tconst spawnedToken = canvas.scene.collections.tokens.get(spawnedTokenId)\r\n\treturn spawnedToken.uuid\r\n}\r\nconst getWarpgateCallbacks = async (tokenUuid) => {\r\n\treturn {\r\n\t\tpre: async (template,update,token) => {\r\n\t\t\tsetEffectsSequencer(template, update, token, tokenUuid)\r\n\t\t\tawait warpgate.wait(2650)\r\n\t\t},\r\n\t\tpost: async (template, token) => {\r\n\t\t\tsetPostEffectsSequencer(template,token)\r\n\t\t}\r\n\t}\r\n}\r\nconst getWarpgateOptions = async (actor) => {\r\n\treturn {controllingActor: actor}\r\n}\r\nconst getWarpgateUpdates = async (spawn, originActorSenses, originTokenSight) => {\r\n\tconst updates = await getSpawnUpdates(originActorSenses, originTokenSight)\r\n\treturn mergeObject(updates, spawn)\r\n}\r\nconst setEffectsSequencer = async (template, update, token, originTokenUuid) => {\r\n\tconst color = \"blue\"\r\n\tconst originToken = await fromUuid(originTokenUuid)\r\n\tnew Sequence()\r\n\t\t.effect()\r\n\t\t\t.file(`jb2a.magic_signs.circle.02.divination.intro.${color}`)\r\n\t\t\t.scale(.15)\r\n\t\t\t.opacity(1)\r\n\t\t\t.atLocation(originToken)\r\n\t\t\t.belowTokens() \r\n\t\t\t.waitUntilFinished(-1150)\r\n\t\t.effect()\r\n\t\t\t.file(`jb2a.magic_signs.circle.02.divination.loop.${color}`)\r\n\t\t\t.scale(.15)\r\n\t\t\t.atLocation(originToken)\r\n\t\t\t.belowTokens() \r\n\t\t\t.fadeIn(200)\r\n\t\t\t.opacity(1)\r\n\t\t\t.waitUntilFinished(-1150)\r\n\t\t.effect()\r\n\t\t\t.file(`jb2a.magic_signs.circle.02.divination.outro.${color}`)\r\n\t\t\t.scale(.15)\r\n\t\t\t.opacity(1)\r\n\t\t\t.atLocation(originToken)\r\n\t\t\t.belowTokens() \r\n\t\t.play()\t\r\n}\r\nconst setHookMacros = async (actor, spawnedTokenUuid) => {\r\n\tconst userIsGM = game.users.find(user => user.id == game.userId).isTheGM\r\n\tif (!userIsGM) {\r\n\t\tawait socket.executeAsGM(\"setDeleteSummonConcentrationHook\", actor, spawnedTokenUuid)\r\n\t}\r\n\tconst deleteSummonConcentrationHookId = Hooks.on(\"deleteToken\", (tokenDoc, config, options) => {\r\n\t\tif (tokenDoc.uuid == spawnedTokenUuid) {\t\t\r\n\t\t\tHooks.off(\"preDeleteToken\", deleteSummonConcentrationHookId)\r\n\t\t\tconst concEffect =  actor.effects.find(effect => effect.name == \"Concentrating\")\t\t\t\t\r\n\t\t\tif (!concEffect) return false\r\n\t\t\tconcEffect.delete()\t\t\t\t\r\n\t\t}\r\n\t})\t\t\r\n}\r\nconst setPostEffectsSequencer = async (template, token) => {\r\n\tconst sequencerPath = \"jb2a.impact.009.blue\"\r\n\tnew Sequence()\r\n\t\t.animation()\r\n\t\t\t.on(token)\r\n\t\t\t.fadeIn(250)\t\r\n\t\t.effect()\r\n\t\t\t.file(sequencerPath)\r\n\t\t\t.atLocation({x: template.x, y: template.y})\t\r\n\t\t\t.scale(.25)\r\n\t\t\t.opacity(1)\r\n\t\t.play()\r\n\t\r\n}\r\nconst setPostSpawnEffects = async (spawnedTokenUuid, originTokenActorUuid) => {\r\n\tconst fromUuidActor = await fromUuid(originTokenActorUuid)\r\n\tawait setActorConcRemoveUuids(fromUuidActor, spawnedTokenUuid)\r\n\tawait setHookMacros(fromUuidActor, spawnedTokenUuid)\t\r\n}\r\nconst setSpawnedTokenId = async (tokenUuid, itemRange, actor, originToken) => {\r\n\tconst spawn = {\r\n\t\ttoken: { name:\"Clairvoyance\"},\r\n\t\tactor: { name:\"Clairvoyance\"}\r\n\t}\r\n\tconst location = await getSpawnLocation(\"modules/jb2a_patreon/Library/5th_Level/Wall_Of_Force/WallOfForce_01_Grey_Sphere_400x400.webm\", 1, 4, tokenUuid, itemRange, originToken)\r\n\tconst spawnedTokenId = await warpgate.spawnAt({x: location.x, y: location.y}, spawn.token.name, await getWarpgateUpdates(spawn, actor.system.attributes.senses, originToken.document.sight), await getWarpgateCallbacks(tokenUuid), await getWarpgateOptions(actor))\r\n\treturn spawnedTokenId[0]\r\n}\r\nconst setSpellEffects = async ({speaker, actor, token, character, item, args, scope, workflow}) => {\r\n\tif (args[0].tag == \"OnUse\" && args[0].macroPass == \"preItemRoll\") {\r\n\t\tawait setActorConcDeletion(actor)\r\n\t} else {\t\r\n\t\tconst spawnedTokenUuid = await getTokenSpawnIds(args[0].tokenUuid, 5280, actor, token)\t\t\r\n\t\tawait setPostSpawnEffects(spawnedTokenUuid, token.document.actor.uuid)\t\r\n\t}\r\n}\r\n\r\nexport const clairvoyance = {\r\n\t\"setSpellEffects\": setSpellEffects\r\n}","//Logic\r\n//1.  Menu comes up that player chooses between creature or environment.  Not going to worry about objects for now, if ever\r\n//2.  If creature, we put on an ATL active effect.  Could theoretically add some extra logic to control emission angle, but won't worry about that for now\r\n//3.  If environment, player is given option to select a point on the ground\r\n//4.  AmbientLightDocument is created at the x/y from the chosen point\r\n//5.  Stretch goal - figure out how to dispel the darkness spell upon contact with Daylight\r\n\r\n//TODO:\r\n//look into dispeling darkness\r\n//get all templates in range on map\r\n////can we account for templates that would be behind walls?\r\n////might need to get array of all parts of the grid it touches to do anything useful\r\n//get templates in range and see if any part overlaps \r\n//check between origin of spell and target location when comparing and make sure there is nothing blocking them like a wall\r\n//set up a hook to make sure no darkness spells are cast within the main aoe\r\n//need to account for creatures with darkness cast on them specifically\r\n//need to make sure daylight effect aura cast on a creature is also dispelling darkness as they move \r\n\r\n//More TODO (2023.11.30):\r\n//account for spell cast on creature and treat it like an aura in regards to the dispel\r\n//account for walls blocking the aoe's dispel ability\r\n//make sure everything works on player side\r\n\r\nimport {getDialogueButtonType, setActiveEffects, setTemplateDispels} from \"../../helper-functions.js\"\r\nimport {setAreaEffectDeleteHook} from \"../../hooks.js\"\r\nimport {socket} from \"../../index.js\"\r\n\r\nconst getEffectOriginData = async (originUuid, lightId) => {\r\n\treturn {\r\n\t\tname: `Daylight`, \r\n\t\ticon: \"icons/magic/air/weather-sunlight-sky.webp\", \r\n\t\torigin: originUuid,\r\n\t\tchanges: [{key: \"macro.execute\", mode: 0, value: \"function.test.macros.daylight.setSpellEffects\"}],\r\n\t\t\"flags.castData.daylight.lightId\": lightId,\r\n\t\t\"flags.dae.showIcon\": false,\t\t\r\n\t\t\"flags.dae.specialDuration\": [\"shortRest\", \"longRest\"],\r\n\t\t\"flags.dae.stackable\": \"multi\",\r\n\t\t\"flags.times-up.isPassive\": true,\t\t\r\n\t\tdisabled: false\r\n\t}\r\n}\r\nconst getEffectTokenData = async (originUuid) => {\r\n\treturn {\r\n\t\tname: `Daylight`, \r\n\t\ticon: \"icons/magic/air/weather-sunlight-sky.webp\", \r\n\t\tduration: {rounds: 600},\r\n\t\torigin: originUuid,\r\n\t\tchanges: [\r\n\t\t\t{key: `ATL.light.dim`, mode: CONST.ACTIVE_EFFECT_MODES.CUSTOM, value: [120]},\r\n\t\t\t{key: `ATL.light.bright`, mode: CONST.ACTIVE_EFFECT_MODES.CUSTOM, value: [60]},\r\n\t\t\t{key: `ATL.light.attenuation`, mode: CONST.ACTIVE_EFFECT_MODES.CUSTOM, value: [.35]}\r\n\t\t],\r\n\t\t\"flags.dae.stackable\": \"multi\",\r\n\t\t\"flags.times-up.isPassive\": false,\r\n\t\t\"flags.dae.specialDuration\": [\"shortRest\", \"longRest\"],\r\n\t\t\"flags.dae.showIcon\": true,\r\n\t\tdisabled: false\r\n\t}\r\n}\r\nconst getIconPaths = (buttonName) => {\r\n\tswitch (buttonName) {\r\n\t\tcase \"Area of Effect\":\r\n\t\t\treturn \"icons/magic/air/weather-clouds-sunlight.webp\"\r\n\t\t\tbreak\r\n\t\tcase \"Selected Target\":\r\n\t\t\treturn \"icons/magic/air/weather-sunlight-sky.webp\"\r\n\t\t\tbreak\r\n\t}\r\n}\r\nconst setAreaChoiceEffects = async (templateUuid, templateEffect, tokenActorUuid, itemUuid, positions) => {\r\n\tconsole.log(\"setAreaChoiceEffects positions\")\r\n\tconsole.log(positions)\r\n\tconst [x, y] = await setTemplateEffects(templateUuid, templateEffect, positions)\r\n\tconst lightParams = {\"x\": x, \"y\": y, \"config\": {\"bright\": 60, \"dim\": 120, \"attenuation\": .4}}\r\n\tconst [sanitizedLight] = await socket.executeAsGM(\"setAmbientLightCreate\", lightParams)\r\n\tconst [effect] = await setActiveEffects([tokenActorUuid], await getEffectOriginData(itemUuid, sanitizedLight._id))\t\r\n\t//Gotta fix below \r\n\tawait setAreaEffectDeleteHook(60, x, y, [\"Darkness\"], 9, effect, positions)\r\n}\r\nconst setEffectsSequencer = async (x, y, scale, token) => {\r\n\tif (!token) {\r\n\t\tnew Sequence()\r\n\t\t\t.effect()\r\n\t\t\t\t.file(`jb2a.markers.light.complete.yellow`)\r\n\t\t\t\t.scale(scale)\r\n\t\t\t\t.opacity(1)\r\n\t\t\t\t.atLocation({\"x\": x, \"y\": y})\r\n\t\t\t.play()\t\t\t\t\r\n\t} else {\r\n\t\tnew Sequence()\r\n\t\t\t.effect()\r\n\t\t\t\t.file(`jb2a.markers.light.complete.yellow`)\r\n\t\t\t\t.scale(scale)\r\n\t\t\t\t.opacity(1)\r\n\t\t\t\t.attachTo(token)\r\n\t\t\t.play()\t\t\t\r\n\t}\r\n}\r\nconst setInitChoice = async (itemUuid)  => {\r\n\tconst type = await getDialogueButtonType([\"Area of Effect\", \"Selected Target\"], {width: 400, height: 150}, \"Where will you cast Daylight?\", getIconPaths, 60, 60)\r\n\tif (type.value == \"Selected Target\") {\r\n\t\tconst target = game.user.targets.first()\r\n\t\tawait setActiveEffects([target.document.actor.uuid], await getEffectTokenData(itemUuid))\r\n\t\tawait setEffectsSequencer(0, 0, target.document.width, target)\r\n\t\treturn false\t\t\t\r\n\t}\t\r\n\treturn true\r\n}\r\nconst setSpellEffects = async ({speaker, actor, token, character, item, args, scope, workflow}) => {\r\n\tif (args[0].tag == \"OnUse\" && args[0].macroPass == \"preItemRoll\") {\r\n\t\tconst isAreaChoice = await setInitChoice(item.uuid)\r\n\t\tif (!isAreaChoice) return false\r\n\t} else if (args[0].tag == \"OnUse\" && args[0].macroPass == \"postActiveEffects\") {\r\n\t\tconst templateId = \"MeasuredTemplate.\" + args[0].templateId \r\n\t\tconst templatePositions = canvas.grid.highlightLayers[templateId].positions\r\n\t\tconst templateEffect = actor.effects.find(effect => effect.name == \"Daylight Template\")\r\n\t\tawait setAreaChoiceEffects(args[0].templateUuid, templateEffect, token.document.actor.uuid, item.uuid, templatePositions)\r\n\t} else if (args[0] == \"off\")  {\r\n\t\tconst lastArg = args[args.length - 1]\r\n\t\tawait socket.executeAsGM(\"setAmbientLightDelete\", lastArg.efData.flags.castData.daylight.lightId)\r\n\t} else {\r\n\t\treturn false\r\n\t}\r\n}\r\nconst setTemplateEffects = async (templateUuid, templateEffect, templatePositions) => {\r\n\tconst template = await fromUuid(templateUuid)\r\n\tawait setEffectsSequencer(template.x, template.y, 7, false)\r\n\tawait setTemplateDispels(template.x, template.y, \"Darkness\", templatePositions)\r\n\ttemplateEffect.delete()\r\n\treturn [template.x, template.y]\r\n}\r\n\r\nexport const daylight = {\r\n\t\"setSpellEffects\": setSpellEffects\r\n}","import {getTemplatesInRange, getTemplatesWithOverlap} from \"./helper-functions.js\"\r\nimport {settings} from \"./settings.js\"\r\nimport {socket} from \"./index.js\"\r\n\r\nexport const setAreaEffectDeleteHook = async (range, x, y, ineligibleEffectNames, minSpellLevel, originTemplateActiveEffect, itemTemplatePositions) => {\r\n\tconsole.log(\"PRE HOOK\")\r\n\tconsole.log(\"x\")\r\n\tconsole.log(x)\r\n\tconsole.log(\"y\")\r\n\tconsole.log(y)\r\n\tconsole.log(itemTemplatePositions)\r\n\t\r\n\t//const setAreaEffectDeleteHookId = Hooks.on(\"midi-qol.postTemplatePlaced\", (workflow) => {\r\n\t//\tconsole.log(\"setAreaEffectDeleteHookId workflow\")\r\n\t//\tconsole.log(workflow)\r\n\t//\tconst template = fromUuidSync(workflow.templateUuid)\r\n\t//\tconst gridTemplateId = \"MeasuredTemplate.\" + template.id\r\n\t//\tconst test1 = canvas.grid.highlightLayers[gridTemplateId]\r\n\t//\tconsole.log(test1)\r\n\t//})\r\n\t\r\n\tconst setAreaEffectDeleteHookId = Hooks.on(\"refreshMeasuredTemplate\", (templateData) => {\r\n\t\tconsole.log(\"INTO HOOK\")\r\n\t//\tconsole.log(workflow)\r\n\t\tconst template = templateData.document\r\n\t\t\r\n\t\tconsole.log(\"setAreaEffectDeleteHookId template\")\r\n\t\tconsole.log(template)\r\n\t\tconst gridTemplateId = \"MeasuredTemplate.\" + template.id\r\n\t\tconst gridTemplatePositions = canvas.grid.highlightLayers[gridTemplateId].positions\r\n\t\tconsole.log(\"setAreaEffectDeleteHookId canvas.grid.highlightLayers[gridTemplateId]\")\r\n\t\tconsole.log(canvas.grid.highlightLayers[gridTemplateId])\t\t\t\t\r\n\t\tconsole.log(\"setAreaEffectDeleteHookId gridTemplatePositions\")\r\n\t\tconsole.log(gridTemplatePositions)\t\t\t\t\r\n\t\tconst originFlag = template.flags?.dnd5e?.origin ?? false\r\n\t\tconst templateSpellLevel = template.flags?.dnd5e?.spellLevel ?? 0\r\n\t\tif (!originFlag || templateSpellLevel > minSpellLevel) return false\t\t\r\n\t\tconst origin = fromUuidSync(template.flags.dnd5e.origin)\r\n\t\tconsole.log(\"hook templateData origin\")\r\n\t\tconsole.log(origin)\r\n\t\tif (ineligibleEffectNames.includes(origin.name) || ineligibleEffectNames == \"all\") {\t\t\t\r\n\t\t\tconst templatesOverlap = itemTemplatePositions.intersection(gridTemplatePositions).size > 0 \r\n\t\t\tconsole.log(\"setAreaEffectDeleteHookId templatesOverlap\")\r\n\t\t\tconsole.log(templatesOverlap)\t\r\n\t\t\tif (!templatesOverlap) return false\r\n\t\t\tconsole.log(\"setAreaEffectDeleteHookId templatesOverlap\")\r\n\t\t\tconsole.log(templatesOverlap)\t\t\t\t\r\n\t\r\n\t\t\t//waiting for potential concentration effects to cycle through\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tconsole.log(\"INTO TIMEOUT\")\r\n\t\t\t\t\tconsole.log(\"TIMEOUT template\")\r\n\t\t\t\t\tconsole.log(template)\r\n\t\t\t\t\tsocket.executeAsGM(\"setMeasuredTemplateDelete\", template.uuid)\r\n\t\t\t}, 200)\t\t\t\t\r\n\r\n\t\t}\r\n\t})\r\n\tawait setAreaEffectDeleteHookOff(originTemplateActiveEffect, setAreaEffectDeleteHookId)\r\n}\r\nexport const setAreaEffectDeleteHookOff = async (templateEffect, setAreaEffectDeleteHookId) => {\r\n\tconst setAreaEffectDeleteHookOffId = Hooks.on(\"deleteActiveEffect\", (effect, config) => {\t\t\t\r\n\t\tif (effect.uuid == templateEffect.uuid) {\r\n\t\t\tHooks.off(\"createMeasuredTemplate\", setAreaEffectDeleteHookId)\r\n\t\t\tHooks.off(\"deleteActiveEffect\", setAreaEffectDeleteHookOffId)\r\n\t\t}\r\n\t})\r\n}","import {cloudSpellNames} from \"../../constants.js\"\r\n\r\nconst getAoeOverlapPerc = async (args) => {\r\n\tconst creatureCoords = await getCreatureCoords(args[0].actor.token)\r\n\tconst templateCoords = await getTemplateCoords(args[0].templateId) ?? false\r\n\tif (!templateCoords) return 0\r\n\tconst overlap = creatureCoords.intersection(templateCoords)\r\n\treturn overlap.size / creatureCoords.size\r\n}\r\nconst getCreatureCoords = async (tokenDoc) => {\r\n\tconst gridSize = canvas.scene.grid.size\r\n\tlet set = new Set()\r\n\tlet position = \"\"\r\n\tfor (let i = 0; i < tokenDoc.height; i++) {\r\n\t\tfor (let j = 0; j < tokenDoc.width; j++) {\r\n\t\t\tposition = (tokenDoc.x + gridSize*i).toString() + \".\" + (tokenDoc.y + gridSize*j).toString() \r\n\t\t\tset.add(position)\r\n\t\t}\r\n\t}\r\n\treturn set\r\n}\r\nconst getNewDamage = async(hpDamage, hordeCount, multiplier, hasAreaTarget) => {\r\n\treturn hasAreaTarget ? Math.floor(hpDamage * hordeCount * multiplier) : hpDamage\r\n}\r\nconst getTemplateCoords = async (templateId) => {\r\n\tconst templateIdStr = \"MeasuredTemplate.\" + templateId\r\n\treturn canvas.grid.highlightLayers[templateIdStr].positions\r\n}\r\nconst isSaveFailure = async ({args, item}) => {\r\n\tconst hasAreaTarget = item.system.hasAreaTarget || cloudSpellNames.includes(item.name)\r\n\tconsole.log(await getAoeOverlapPerc(args))\r\n\tif (!item.system.hasAreaTarget || await getAoeOverlapPerc(args) <= .666) {\r\n\t\tHooks.once(\"createActiveEffect\", (effect) => {\t\t\t\r\n\t\t\teffect.delete()\r\n\t\t})\r\n\t}\t\r\n}\r\nconst preTargetDamageApplication = async ({actor, args, item, workflow, token}) => {\r\n\tif (workflow.hitTargets.size < 1) return false\r\n\tconst hordeItem = await fromUuid(actor.items.find(item => item.name == \"Horde\").uuid)\r\n\tconst hordeItemUses = hordeItem.system.uses.value\r\n\tconst hordeItemUsesMax = hordeItem.system.uses.max\r\n\tconst liveTokenDoc = await fromUuid(token.document.uuid)\r\n\tconst hpDamage = workflow.damageItem.hpDamage\r\n\tconst hasAreaTarget = item.system.hasAreaTarget || cloudSpellNames.includes(item.name)\r\n\tif (hpDamage > 0) setHpUpdateEffects(actor, hpDamage, hordeItem, hordeItemUses, hordeItemUsesMax, hasAreaTarget, workflow, liveTokenDoc, args)\r\n}\r\nconst setHpUpdateEffects = async (actor, hpDamage, hordeItem, hordeItemUses, hordeItemUsesMax, hasAreaTarget, workflow, liveTokenDoc, args) => {\r\n\tconst aoeOverlapPerc = await getAoeOverlapPerc(args)\r\n\tconst newHpDamage = await getNewDamage(hpDamage, hordeItemUses, aoeOverlapPerc, hasAreaTarget)\r\n\tworkflow.damageItem.hpDamage = newHpDamage\r\n\tsetPostDamageUpdates(actor, newHpDamage, liveTokenDoc, hordeItem, hordeItemUsesMax)\r\n}\r\nconst setLiveTokenDocUpdates = async (texture, hordeItem, hordeItemUsesMax, multiplier, liveTokenDoc, shouldReduce, tokenSizeNum) => {\r\n\t\thordeItem.update({\"system.uses.value\": hordeItemUsesMax * multiplier})\r\n\t\tif (tokenSizeNum > 2 && shouldReduce) {\r\n\t\t\tawait warpgate.wait(4000)\t\r\n\t\t\tsetSequencer(liveTokenDoc)\r\n\t\t\tawait warpgate.wait(200)\t\r\n\t\t\tif (liveTokenDoc.actor.system.traits.size != \"grg\" && liveTokenDoc.width <= 4 && liveTokenDoc.width <= 4) {\r\n\t\t\t\tliveTokenDoc.actor.update({\"system.traits.size\": Object.keys(CONFIG.DND5E.actorSizes)[tokenSizeNum - 1]})\r\n\t\t\t}\r\n\t\t\tliveTokenDoc.update({\"width\": liveTokenDoc.width - 1, \"height\": liveTokenDoc.width - 1})\t\r\n\t\t}\r\n\t\tliveTokenDoc.update({\"texture.src\": texture})\r\n}\r\nconst setPostDamageUpdates = async (actor, newHpDamage, liveTokenDoc, hordeItem, hordeItemUsesMax) => {\r\n\tconst newHealthPercentage = ((actor.system.attributes.hp.value - newHpDamage) / actor.system.attributes.hp.max) * 100\r\n\tconst tokenSizeNum = Object.keys(CONFIG.DND5E.actorSizes).indexOf(liveTokenDoc.actor.system.traits.size)\r\n\tlet shouldReduce = false\r\n\tif (75 >= newHealthPercentage && newHealthPercentage > 50) {\r\n\t\tsetLiveTokenDocUpdates(actor.flags[\"midi-qol\"].hordePassive.img1, hordeItem, hordeItemUsesMax, .75, liveTokenDoc, shouldReduce, tokenSizeNum)\r\n\t} else if (50 >= newHealthPercentage && newHealthPercentage > 25) {\r\n\t\tshouldReduce = tokenSizeNum > 3\r\n\t\tsetLiveTokenDocUpdates(actor.flags[\"midi-qol\"].hordePassive.img2, hordeItem, hordeItemUsesMax, .50, liveTokenDoc, shouldReduce, tokenSizeNum)\r\n\t} else if (25 >= newHealthPercentage && newHealthPercentage >= 0) {\r\n\t\tshouldReduce = tokenSizeNum > 3\r\n\t\tsetLiveTokenDocUpdates(actor.flags[\"midi-qol\"].hordePassive.img3, hordeItem, hordeItemUsesMax, .25, liveTokenDoc, shouldReduce, tokenSizeNum)\r\n\t} \r\n}\r\nconst setSequencer = async (liveTokenDoc) => {\r\n\tnew Sequence()\r\n\t\t.effect()\r\n\t\t\t.file(liveTokenDoc.actor.flags[\"midi-qol\"].hordePassive.sequencerPath)\r\n\t\t\t.atLocation(liveTokenDoc)\r\n\t\t.play()\r\n}\r\n\r\nexport const hordePassive = {\r\n\tisSaveFailure,\r\n\tpreTargetDamageApplication\r\n}","import {getDialogueButtonType, setActiveEffects} from \"../../helper-functions.js\"\r\n\r\nconst getCommandItemData = async (originActor, type) => {\r\n\tconst sourceItem = type.value == \"Command: Flee\" ? await fromUuid(\"Item.TLqebf57ZF6HUkml\") : await fromUuid(\"Item.9iKDqMbCAERS9psP\")\r\n\tconsole.log(sourceItem)\r\n\tconst itemData = mergeObject(duplicate(sourceItem.toObject(false)), {\r\n\t\t\t//name: \"Wand of Fear\"\r\n\t}, {overwrite: true, inlace: true, insertKeys: true, insertValues: true})\r\n\treturn new CONFIG.Item.documentClass(itemData, { parent: originActor })\r\n}\r\nconst getFearItemData = async (originActor) => {\r\n\tconst sourceItem = await fromUuid(\"Item.DG5FfgOrf5IhvITt\")\r\n\tconst itemData = mergeObject(duplicate(sourceItem.toObject(false)), {\r\n\t\tname: \"Wand of Fear\"\r\n\t}, {overwrite: true, inlace: true, insertKeys: true, insertValues: true})\r\n\treturn new CONFIG.Item.documentClass(itemData, { parent: originActor })\r\n}\r\nconst getIconPaths = (buttonName) => {\r\n\tswitch (buttonName) {\r\n\t\tcase \"Fear\":\r\n\t\t\treturn \"icons/magic/control/fear-fright-monster-purple-blue.webp\"\r\n\t\t\tbreak\r\n\t\tcase \"Command: Flee\":\r\n\t\t\treturn \"icons/magic/control/fear-fright-shadow-monster-purple.webp\"\r\n\t\t\tbreak\r\n\t\tcase \"Command: Prone\":\r\n\t\t\treturn \"icons/magic/control/silhouette-fall-slip-prone.webp\"\r\n\t\t\tbreak\t\t\t\r\n\t}\r\n}\r\nconst onUse = async ({args, item, actor, token}) => {\r\n\tconst buttonOptions = item.system.uses.value > 1 ? [\"Fear\", \"Command: Flee\", \"Command: Prone\"] : [\"Command: Flee\", \"Command: Prone\"]\r\n\tconst type = await getDialogueButtonType(buttonOptions, {width: 400, height: 150}, \"What do you want to cast?\", getIconPaths, 60, 60)\r\n\tif (type.value == \"Fear\") {\r\n\t\tsetFearEffects(actor, item)\r\n\t} else {\r\n\t\tsetCommandEffects(actor, item, token, type)\r\n\t}\r\n}\r\nconst setCommandEffects = async (actor, item, token, type) => {\r\n\tconst commandItem = await getCommandItemData(actor, type)\r\n\tconst target = game.user.targets?.first() ?? false\r\n\tif (!target) return false\r\n\tconst options = { showFullCard: false, createWorkflow: true, versatile: false, configureDialog: false, targetUuids: [target.document.uuid]}\r\n\tconst commandWorkflow = await MidiQOL.completeItemUse(commandItem, {}, options)\t\r\n\tsetCommandEffectsSequencer(target)\r\n\tsetItemUsesUpdate(item.uuid, 1)\t\r\n}\r\nconst setCommandEffectsSequencer = async (token) => {\r\n\tnew Sequence()\r\n\t\t.effect()\r\n\t\t\t.file(`jb2a.magic_signs.circle.02.enchantment.complete.dark_purple`)\r\n\t\t\t.scale(.25)\r\n\t\t\t.opacity(1)\r\n\t\t\t.attachTo(token)\r\n\t\t\t.belowTokens()\r\n\t\t.play()\t\t\t\r\n}\r\nconst setEffectsSequencer = async (x, y, scale, token, template) => {\r\n\tnew Sequence()\r\n\t\t.effect()\r\n\t\t\t.file(`jb2a.detect_magic.cone.purple`)\r\n\t\t\t.scale(4.4)\r\n\t\t\t.opacity(1)\r\n\t\t\t.atLocation({x: template.x, y: template.y})\r\n\t\t\t.spriteOffset({x: 600, y:0}, {local: true})\r\n\t\t\t.rotate(-template.direction)\r\n\t\t.play()\t\t\t\r\n}\r\nconst setFearEffects = async (actor, item) => {\r\n\tconst fearItem = await getFearItemData(actor)\r\n\tconst options = { showFullCard: false, createWorkflow: true, versatile: false, configureDialog: false}\r\n\tconst fearWorkflow = await MidiQOL.completeItemUse(fearItem, {}, options)\t\r\n\tconst liveTemplate = await fromUuid(fearWorkflow.templateUuid)\r\n\tsetEffectsSequencer(0, 0, 1, false, liveTemplate)\r\n\tsetItemUsesUpdate(item.uuid, 2)\t\r\n}\r\nconst setItemUsesUpdate = async (itemUuid, usesUsed) => {\r\n\tconst liveItem = await fromUuid(itemUuid)\r\n\tliveItem.update({\"system.uses.value\": liveItem.system.uses.value - usesUsed})\r\n}\r\n\r\nexport const wandOfFear = {\r\n\tonUse\r\n}","import {auraOfPurity} from \"./macros/spells/aura-of-purity.js\"\r\nimport {blight} from \"./macros/spells/blight.js\"\r\nimport {clairvoyance} from \"./macros/spells/clairvoyance.js\"\r\nimport {daylight} from \"./macros/spells/daylight.js\"\r\nimport {feyAncestry} from \"./macros/features/fey-ancestry.js\"\r\nimport {hordePassive} from \"./macros/features/horde-passive.js\"\r\nimport {songOfRest} from \"./macros/features/class/bard/song-of-rest.js\"\r\nimport {wandOfFear} from \"./macros/items/wand-of-fear.js\"\r\n\r\nexport const macros = {\r\n\tauraOfPurity,\r\n\tblight,\r\n\tclairvoyance,\r\n\tdaylight,\r\n\tfeyAncestry,\r\n\thordePassive,\r\n\tsongOfRest,\r\n\twandOfFear\r\n}","const getBlightEffectData = async (origin) => {\r\n\treturn {\r\n\t\tname: `Blight Saving Throw Disadvantage`, \r\n\t\ticon: \"icons/magic/movement/chevrons-down-yellow.webp\", \r\n\t\torigin: origin,\r\n\t\tchanges: [{key: \"flags.midi-qol.disadvantage.ability.save.all\", mode: CONST.ACTIVE_EFFECT_MODES.CUSTOM, value: [\"1\"], \"priority\": 20}],\r\n\t\t\"flags.dae.stackable\": \"noneName\",\r\n\t\t\"flags.times-up.isPassive\": true,\r\n\t\t\"flags.dae.specialDuration\": [\"shortRest\", \"longRest\", \"combatEnd\", \"isSave\"],\r\n\t\t\"flags.dae.showIcon\": false,\r\n\t\tdisabled: false\r\n\t}\r\n}\r\nconst setBlightHook = async (castLevel) => {\r\n\tconst blightPreDamageRollHookId = Hooks.once(\"dnd5e.preRollDamage\", (rolledItem, rollConfig) => {\r\n\t\tconst maxDamageRoll = 8 * castLevel + 32\r\n\t\tconst maxDamageString = String(maxDamageRoll) + \"[necrotic]\" \r\n\t\trollConfig.parts = [maxDamageString]\r\n\t})\t\r\n}\r\nconst setSpellEffects = async ({speaker, actor, token, character, item, args, scope, workflow}) => {\r\n\tif (args[0].hitTargets[0].actor.system.details.type.value == \"plant\") {\r\n\t\tconst effectData = await getBlightEffectData(args[0].item.uuid)\r\n\t\tawait MidiQOL.socket().executeAsGM(\"createEffects\", { actorUuid: args[0].hitTargets[0].actor.uuid, effects: [effectData] })\r\n\t\tawait setBlightHook(args[0].castData.castLevel)\r\n\t}\t\r\n}\r\n\r\nexport const blight = {\r\n\t\"setSpellEffects\": setSpellEffects\r\n}","import {conditionLabels} from \"../../constants.js\"\r\n\r\nconst main = async ({item, workflow, args}) => {\r\n\tconst hasCharm = item.effects.find(effect => effect.changes.find(change => conditionLabels[\"charmed\"].includes(change.value.toLowerCase())))\r\n\tif (hasCharm) {\r\n\t\tworkflow.saveDetails.advantage = true\r\n\t}\r\n}\r\n\r\nexport const feyAncestry = {\r\n\tmain\r\n}","const getItemData = (originActor, songLevel) => {\r\n\tconst sourceItem = fromUuidSync(\"Item.GvIIDEPRp3unaRVe\")\r\n\tconst itemData = mergeObject(duplicate(sourceItem.toObject(false)), {\r\n\t\tname: \"Song of Rest\",\r\n\t\tsystem: { \r\n\t\t\tdamage: {\r\n\t\t\t\tparts: [[`1d${songLevel}`, \"healing\"]]\r\n\t\t\t}\r\n\t\t}\r\n\t}, {overwrite: true, inlace: true, insertKeys: true, insertValues: true})\r\n\treturn new CONFIG.Item.documentClass(itemData, { parent: originActor })\r\n}\r\nconst getOriginBardScale = (effectOriginUuid) => {\r\n\tconst effectOrigin = fromUuidSync(effectOriginUuid)\r\n\tconst originActor = fromUuidSync(effectOrigin.parent.uuid)\r\n\treturn originActor.system.scale.bard[\"song-of-rest\"].faces\r\n}\r\nconst main = (actor, data) => {\r\n\tconst songEffects = actor.effects.filter(effect => effect.name == \"Song of Rest\")\r\n\tif (data.dhd < 0 && songEffects.length > 0) {\r\n\t\tsongEffects.map(effect => {\r\n\t\t\tconst originBardScale = getOriginBardScale(effect.origin)\r\n\t\t\tconst item = getItemData(actor, originBardScale)\r\n\t\t\tconst token = MidiQOL.tokenForActor(actor.uuid)\r\n\t\t\tconst options = { showFullCard: false, createWorkflow: true, versatile: false, configureDialog: false, targetUuids: [token.document.uuid] }\r\n\t\t\tMidiQOL.completeItemUse(item, {}, options)\t\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport const songOfRest = {\r\n\tmain\r\n}","export const setAmbientLightCreate = async (params) => {\r\n\treturn await canvas.scene.createEmbeddedDocuments(\"AmbientLight\", [params])\r\n}\r\nexport const setAmbientLightDelete = async (ambientLightId) => {\r\n\tconst ambientLight = await canvas.scene.deleteEmbeddedDocuments(\"AmbientLight\", [ambientLightId])\r\n\t//can probably be improved to go back to whatever layer you had selected before, even if not token\r\n\tcanvas.tokens.activate()\r\n\treturn ambientLight\r\n}\r\nexport const setMeasuredTemplateDelete = async (templateUuid) => {\r\n\tconst template = await fromUuid(templateUuid) ?? false\r\n\tif (!template) return false\r\n\tconst deletedMeasuredTemplate = await canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\", [template._id])\r\n\t//can probably be improved to go back to whatever layer you had selected before, even if not token\r\n\tcanvas.tokens.activate()\r\n\treturn deletedMeasuredTemplate\r\n}\r\nexport const setActiveEffectDelete = async (ownerActor, effectId) => {\r\n\tconst [deleteEffect] = ownerActor.effects.filter(effect => effect._id == effectId)\r\n\treturn await ownerActor.deleteEmbeddedDocuments(\"ActiveEffect\", [deleteEffect._id])\r\n\t//can probably be improved to go back to whatever layer you had selected before, even if not token\r\n}\r\nexport const setDeleteSummonConcentrationHook = async (actor, spawnedTokenUuid) => {\r\n\tconst preDeleteSummonConcentrationHookId = Hooks.on(\"preDeleteToken\", (tokenDoc, config, options) => {\r\n\t\tif (tokenDoc.uuid == spawnedTokenUuid) {\t\t\r\n\t\t\tHooks.off(\"preDeleteToken\", preDeleteSummonConcentrationHookId)\r\n\t\t\tconst concEffect =  actor.effects.find(effect => effect.name == \"Concentrating\")\t\t\t\t\r\n\t\t\tif (!concEffect) return false\r\n\t\t\tconcEffect.delete()\t\t\t\t\r\n\t\t}\r\n\t})\t\t\t\r\n}","import {setConfig} from './config.js';\r\nimport {macros} from \"./macros.js\"\r\nimport * as sf from \"./socket-functions.js\"\r\n\r\nexport let socket\r\n\r\nHooks.once(\"socketlib.ready\", () => {\r\n\tsocket = socketlib.registerModule(\"charnames-bag-of-macros\")\r\n\tsocket.register(\"setActiveEffectDelete\", sf.setActiveEffectDelete)\r\n\tsocket.register(\"setAmbientLightCreate\", sf.setAmbientLightCreate)\t\r\n\tsocket.register(\"setAmbientLightDelete\", sf.setAmbientLightDelete)\r\n\tsocket.register(\"setDeleteSummonConcentrationHook\", sf.setDeleteSummonConcentrationHook)\r\n\tsocket.register(\"setMeasuredTemplateDelete\", sf.setMeasuredTemplateDelete)\r\n})\r\n\r\nHooks.on(\"dnd5e.restCompleted\", (actor, data) => {\r\n\tmacros.songOfHealing.main(actor, data)\r\n})\r\n\r\nglobalThis['CHARNAME'] = {\r\n    macros\r\n}"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","conditionLabels","blinded","charmed","concentrating","dead","deafened","exhaustion1","exhaustion2","exhaustion3","exhaustion4","exhaustion5","frightened","grappled","incapacitated","invisible","paralyzed","petrified","poisoned","prone","restrained","stunned","unconscious","wounded","cloudSpellNames","getDialogueButtonType","async","choices","dialogueOptions","title","getIconPathsFunc","buttonWidth","buttonHeight","Promise","resolve","buttons","getIconPaths","width","height","reduce","choice","i","icon","label","callback","value","getDialogueButtons","Dialog","render","setActiveEffects","tokenActorUuids","effectData","effects","all","map","tokenActorUuid","MidiQOL","socket","executeAsGM","actorUuid","createEffect","setSpawnedTokenId","tokenUuid","itemRange","actor","originToken","spawn","token","name","location","spawnIconPath","size","interval","target","fromUuid","distance","canvas","scene","grid","warpgate","crosshairs","show","lockSize","lockPosition","tag","drawIcon","x","y","rememberControlled","tokens","activate","setCrosshairConfigs","distanceAvailable","crosshairsDistance","inFlight","wait","ray","Ray","center","measureDistances","gridSpaces","draw","cancelled","getSpawnLocation","spawnedTokenId","spawnAt","originActorSenses","originTokenSight","updates","CONST","TOKEN_DISPLAY_MODES","HOVER","getSpawnUpdates","mergeObject","getWarpgateUpdates","system","attributes","senses","document","sight","pre","template","update","originTokenUuid","color","Sequence","effect","file","scale","opacity","atLocation","belowTokens","waitUntilFinished","fadeIn","play","setEffectsSequencer","post","animation","on","setPostEffectsSequencer","getWarpgateCallbacks","controllingActor","getWarpgateOptions","buttonName","setAreaChoiceEffects","templateUuid","templateEffect","itemUuid","positions","console","log","setTemplateEffects","lightParams","sanitizedLight","originUuid","lightId","origin","changes","mode","disabled","getEffectOriginData","_id","range","ineligibleEffectNames","minSpellLevel","originTemplateActiveEffect","itemTemplatePositions","setAreaEffectDeleteHookId","Hooks","templateData","gridTemplateId","id","gridTemplatePositions","highlightLayers","originFlag","flags","dnd5e","templateSpellLevel","spellLevel","fromUuidSync","includes","templatesOverlap","intersection","setTimeout","uuid","setAreaEffectDeleteHookOffId","config","off","setAreaEffectDeleteHookOff","setAreaEffectDeleteHook","attachTo","templatePositions","templates","gridSize","gridScale","x1","y1","templatesWithOverlap","eligibleTemplates","filter","Set","getTemplatesWithOverlap","originName","a","b","Math","sqrt","pow","itemRangeModified","setTemplateDispels","delete","getAoeOverlapPerc","args","creatureCoords","getCreatureCoords","templateCoords","getTemplateCoords","templateId","tokenDoc","set","position","j","toString","add","templateIdStr","setLiveTokenDocUpdates","texture","hordeItem","hordeItemUsesMax","multiplier","liveTokenDoc","shouldReduce","tokenSizeNum","setSequencer","traits","keys","CONFIG","DND5E","actorSizes","setPostDamageUpdates","newHpDamage","newHealthPercentage","hp","max","indexOf","hordePassive","img1","img2","img3","sequencerPath","setCommandEffectsSequencer","setItemUsesUpdate","usesUsed","liveItem","uses","macros","auraOfPurity","preTargetSave","workflow","item","some","change","toLowerCase","saveDetails","advantage","onUse","tokenAttacher","attachElementToToken","parent","tokenDocs","Array","from","collections","values","eligibleTokenDocs","tokenDocuments","originX","originY","tokenDocsInRange","tokenTopLeftCenterX","tokenTopLeftCenterY","tokenGridBorderCoords","push","xArr","coord","yArr","maxX","maxY","coords","x2","y2","length","getTokensInRange","templateNonEffectedTokens","itemEffectName","statuses","has","getNonTemplateEffectedTokenDocs","getEligibleTokenDocuments","tokenEffectUuids","casterDisposition","effected","disposition","game","dfreds","effectInterface","addEffect","effectName","setTokenEffects","blight","speaker","character","scope","hitTargets","details","type","ACTIVE_EFFECT_MODES","CUSTOM","getBlightEffectData","castLevel","once","rolledItem","rollConfig","maxDamageString","String","parts","setBlightHook","castData","clairvoyance","macroPass","find","setActorConcDeletion","spawnedTokenUuid","getTokenSpawnIds","originTokenActorUuid","fromUuidActor","originActor","originActorConcentrationRemoveUuids","removeUuids","concEffect","setActorConcRemoveUuids","users","user","userId","isTheGM","deleteSummonConcentrationHookId","options","setHookMacros","setPostSpawnEffects","daylight","targets","first","duration","rounds","getEffectTokenData","setInitChoice","lastArg","efData","feyAncestry","main","isSaveFailure","hasAreaTarget","preTargetDamageApplication","items","hordeItemUses","hpDamage","damageItem","aoeOverlapPerc","hordeCount","floor","getNewDamage","setHpUpdateEffects","songOfRest","data","songEffects","dhd","originBardScale","effectOriginUuid","effectOrigin","bard","faces","getOriginBardScale","songLevel","sourceItem","itemData","duplicate","toObject","damage","overwrite","inlace","insertKeys","insertValues","Item","documentClass","getItemData","showFullCard","createWorkflow","versatile","configureDialog","targetUuids","tokenForActor","completeItemUse","wandOfFear","buttonOptions","fearItem","getFearItemData","fearWorkflow","spriteOffset","local","rotate","direction","setFearEffects","commandItem","getCommandItemData","setCommandEffects","setAmbientLightCreate","params","createEmbeddedDocuments","setAmbientLightDelete","ambientLightId","ambientLight","deleteEmbeddedDocuments","setMeasuredTemplateDelete","deletedMeasuredTemplate","setActiveEffectDelete","ownerActor","effectId","deleteEffect","setDeleteSummonConcentrationHook","preDeleteSummonConcentrationHookId","socketlib","registerModule","register","songOfHealing","globalThis"],"sourceRoot":""}